user www-data;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

worker_processes  4;

events {
    worker_connections  8096;
    multi_accept        on;
    use                 epoll;
}

worker_rlimit_nofile 40000;

http {
        ##
        # Basic Settings
        ##
        proxy_cache_path /tmp/cache levels=1:2 keys_zone=cache:60m max_size=1G;
        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        keepalive_timeout 2000;
        client_body_timeout 2000;
        client_header_timeout 240;
        proxy_connect_timeout 2000;
        proxy_send_timeout 2000;
        proxy_read_timeout 2000;
        types_hash_max_size 2048;
        server_names_hash_bucket_size 130;
        client_max_body_size 100m;
        include /etc/nginx/mime.types;
        default_type application/octet-stream;
        client_header_buffer_size 64k;
        large_client_header_buffers 4 64k;
        # http2 protocol error on chrome https://stackoverflow.com/questions/60974237/chrome-neterr-http2-protocol-error-200-after-a-reconnect
        http2_max_field_size 64k;
        http2_max_header_size 512k;
    proxy_buffer_size          128k;
    proxy_buffers              4 256k;
    proxy_busy_buffers_size    256k;
        #Nginx security
        server_tokens off;
        #Lucas configuracao de seguranca
#        add_header X-Content-Type-Options "nosniff" always;
#        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload";
#        add_header X-Frame-Options SAMEORIGIN always;
        #add_header X-XSS-Protection "1; mode=block" always;

        #PAGESPEED
        #pagespeed on;
        #pagespeed ImageMaxRewritesAtOnce 50;
        #pagespeed Statistics on;
        #pagespeed StatisticsLogging on;
        #pagespeed EnableCachePurge on;
        #pagespeed MessageBufferSize 1000000;
        #pagespeed LogDir /var/log/pagespeed;
        #pagespeed CreateSharedMemoryMetadataCache "/var/cache/nginx/ngx_pagespeed/" 500000;
        #pagespeed FileCachePath "/var/cache/nginx/ngx_pagespeed/";
        #pagespeed LRUCacheKbPerProcess     8192;
        #pagespeed LRUCacheByteLimit        16384;
        #pagespeed DefaultSharedMemoryCacheKB 1000000;
        #pagespeed FileCacheSizeKb 10000000;
        #pagespeed FileCacheCleanIntervalMs 14400000;
        #pagespeed RewriteLevel PassThrough;
        #pagespeed FetchWithGzip on;
        #gzip  on;
        #gzip_vary on;
        # Turn on gzip for all content types that should benefit from it.
        #gzip_types application/ecmascript;
        #gzip_types application/javascript;
        #gzip_types application/json;
        #gzip_types application/pdf;
        #gzip_types application/postscript;
        #gzip_types application/x-javascript;
        #gzip_types image/svg+xml;
        #gzip_types text/css;
        #gzip_types text/csv;
        # "gzip_types text/html" is assumed.
        #gzip_types text/javascript;
        #gzip_types text/plain;
        #gzip_types text/xml;
        #gzip_disable "msie6";
        #gzip_http_version 1.0;

        #PAGESPEED ADMIN PAGES
        #pagespeed StatisticsPath /ngx_pagespeed_statistics;
        #pagespeed GlobalStatisticsPath /ngx_pagespeed_global_statistics;
        #pagespeed MessagesPath /ngx_pagespeed_message;
        #pagespeed ConsolePath /ngx_pagespeed_console;
        #pagespeed AdminPath /ngx_pagespeed_admin;
        #pagespeed GlobalAdminPath /ngx_pagespeed_global_admin;
        #pagespeed StatisticsDomains Allow *;
        #pagespeed GlobalStatisticsDomains Allow *;
        #pagespeed MessagesDomains Allow *;
        #pagespeed ConsoleDomains Allow *;
        #pagespeed AdminDomains Allow *;
        #pagespeed GlobalAdminDomains Allow *;

        ##
        # Gzip Settings
        ##
        gzip on;
        gzip_disable "msie6";
        gzip_min_length  1000;
        gzip_comp_level 9;
        gzip_proxied any;
        gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/javascript application/json application/xml application/font-woff image/svg+xml;


        # Logging Settings
        ##
        log_format include_host_format '$remote_addr - $remote_user [$time_local] '
                            '"$request_method $scheme://$host$request_uri $server_protocol" $status $body_bytes_sent '
                            '"$http_referer" "$http_user_agent"';

        access_log /var/log/nginx/access.log include_host_format buffer=128k;
        error_log /var/log/nginx/error.log;


        ##
        # Virtual Host Configs
        ##

        include /etc/nginx/conf.d/*.conf;
        include /etc/nginx/sites-enabled/*;
}
